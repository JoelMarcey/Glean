<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Glean Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Glean Blog Atom Feed"><title data-react-helmet="true">Angle Guide | Glean</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Angle Guide | Glean"><meta data-react-helmet="true" name="description" content="The following guide will explain Angle from first principles, leading you through from simple queries to more complex ones."><meta data-react-helmet="true" property="og:description" content="The following guide will explain Angle from first principles, leading you through from simple queries to more complex ones."><meta data-react-helmet="true" property="og:url" content="https://glean.software/docs/angle/guide"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://glean.software/docs/angle/guide"><link rel="stylesheet" href="/styles.b813eb11.css">
<link rel="preload" href="/styles.e09754bf.js" as="script">
<link rel="preload" href="/runtime~main.a3268b2c.js" as="script">
<link rel="preload" href="/main.d925dd03.js" as="script">
<link rel="preload" href="/1.59982928.js" as="script">
<link rel="preload" href="/2.5fa3e0ee.js" as="script">
<link rel="preload" href="/3.88208a2f.js" as="script">
<link rel="preload" href="/1be78505.126bd22c.js" as="script">
<link rel="preload" href="/52.0116e487.js" as="script">
<link rel="preload" href="/935f2afb.ed8fbd3b.js" as="script">
<link rel="preload" href="/17896441.6e417407.js" as="script">
<link rel="preload" href="/3a62bff6.4be436fc.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><strong class="navbar__title">Glean</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/introduction">Documentation</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebookincubator/glean" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><strong class="navbar__title">Glean</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/introduction">Documentation</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/facebookincubator/glean" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Quick Start</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/introduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/trying">Trying Glean</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/building">Building Glean</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/walkthrough">Walkthrough</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">User Guide</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Schemas</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/schema/basic">Basic Concepts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/schema/types">Built-in Types</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/schema/syntax">Syntax</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/schema/recursion">Recursion</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/schema/changing">Changing a schema</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/schema/workflow">Workflow</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/schema/thrift">Thrift and JSON</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Querying</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/query/intro">Overview</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Angle</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/angle/intro">Introduction</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/angle/guide">Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/angle/efficiency">Query Efficiency</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/angle/advanced">Advanced Query Features</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/angle/debugging">Debugging</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/angle/reference">Reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/angle/style">Style Guide</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">APIs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/query/api/haskell">Haskell</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/derived">Derived Predicates</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/databases">Glean Databases</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/write">Writing data to Glean</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/running">Running the Tools</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/shell">Using the Shell</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/server">Running the Glean Server</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cli">The Glean CLI tool</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Angle Guide</h1></header><div class="markdown"><p>The following guide will explain Angle from first principles, leading you through from simple queries to more complex ones.</p><p>If you want to try the examples for yourself, or experiment with
changes to the example schema, you should first follow the
instructions in <a href="/docs/walkthrough">Walkthrough</a> to get set up.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="just-the-facts"></a>Just the facts<a class="hash-link" href="#just-the-facts" title="Direct link to heading">#</a></h2><p>Data in Glean is described by a <em>schema</em>, which we normally put in a file with the extension <code>angle</code>. For the purposes of this guide we’ll use the example schema in <code>example.angle</code>. Full details about defining schemas can be found in <a href="/docs/schema/basic">Schemas</a>. The <code>example.angle</code> file contains a schema definition like this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lang=angle codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">schema example.1 {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># definitions go here</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This says we’re defining a schema called <code>example</code>, with version 1.</p><p>The schema contains definitions for <em>predicates</em>. A predicate is the type of <em>facts</em>, which are the individual pieces of information that Glean stores.  Our example schema models a simplified class hierarchy for an object-oriented language, starting with a predicate for a <code>Class</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lang=angle codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">predicate Class :</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     name : string,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     line : nat,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This says that the facts of <code>Class</code> are records with two fields, a <code>name</code> field which contains a <code>string</code>, and a <code>line</code> field which contains a <code>nat</code> (“nat” is short for “natural number”, which is limited to 64 bits in Glean).</p><p>The simplest type of Angle query is one that just selects facts from
the database that match a pattern.  For our first Angle query, let’s
find a class by its name:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">facts&gt; example.Class { name = &quot;Pet&quot; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;id&quot;: 1024, &quot;key&quot;: { &quot;name&quot;: &quot;Pet&quot;, &quot;line&quot;: 10 } }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">1 results, 1 facts, 4.61ms, 117632 bytes, 677 compiled bytes</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>(The last line contains statistics about query performance from Glean; I’ll leave this out in the rest of the examples.)</p><p>What’s going on here?</p><ul><li>The query consists of the <em>predicate name</em> <code>example.Class</code> followed by a <em>pattern</em> <code>{ name = &quot;Pet&quot; }</code></li><li>Note that when we refer to a predicate in a query, the name is <em>qualified</em> by prefixing the schema name, so it’s <code>example.Class</code> rather than just <code>Class</code>.</li><li>The query returns all the facts of <code>example.Class</code> that match the pattern</li></ul><p>The shell shows results in JSON format. When you’re making Glean
queries from code, the results will normally be decoded into native
data types that you can manipulate directly in whatever language
you’re using; for more details see <a href="/docs/schema/thrift">Thrift and
JSON</a>.</p><p>Note that each fact has a unique <code>id</code>. This is how Glean identifies facts in its database. As a user you normally won’t have to worry about fact <code>id</code>s; you can think of them like memory addresses.</p><p>The pattern specifies which facts to return. In the example above, our pattern is matching a record type and specifying a subset of the fields: just the <code>name</code> field. We could match the <code>line</code> field instead:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lang=sh codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">facts&gt; example.Class { line = 20 }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;id&quot;: 1025, &quot;key&quot;: { &quot;name&quot;: &quot;Lizard&quot;, &quot;line&quot;: 20 } }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Your patterns should normally match fields at the <em>beginning</em> of the
record, because facts in the database are indexed by a prefix of the
fields. Matching a field in the middle of the record works by scanning
all the facts, which could be expensive. We’ll get into this in more
detail in <a href="/docs/angle/efficiency">Query Efficiency</a>.</p></div></div><p>What other kinds of patterns can we use? Well, the simplest pattern is the wildcard, “_”, which matches anything.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lang=angle codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">facts&gt; example.Class _</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;id&quot;: 1026, &quot;key&quot;: { &quot;name&quot;: &quot;Fish&quot;, &quot;line&quot;: 30 } }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;id&quot;: 1027, &quot;key&quot;: { &quot;name&quot;: &quot;Goldfish&quot;, &quot;line&quot;: 40 } }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;id&quot;: 1025, &quot;key&quot;: { &quot;name&quot;: &quot;Lizard&quot;, &quot;line&quot;: 20 } }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;id&quot;: 1024, &quot;key&quot;: { &quot;name&quot;: &quot;Pet&quot;, &quot;line&quot;: 10 } }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>We’ll introduce more kinds of pattern in the following sections. The full list of patterns can be found in <a href="/docs/angle/reference">Angle Reference</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="matching-nested-facts"></a>Matching nested facts<a class="hash-link" href="#matching-nested-facts" title="Direct link to heading">#</a></h2><p>The real power of Glean comes from relationships between facts. Facts can refer directly to other facts, and we can write queries that directly match on these connections.</p><p>Our example schema has a predicate that expresses the inheritance relationship between classes:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lang=angle codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">predicate Parent :</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     child : Class,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     parent : Class,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Let’s find what <code>Fish</code> inherits from:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lang=angle codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">facts&gt; example.Parent { child = { name = &quot;Fish&quot; }}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;id&quot;: 1029, &quot;key&quot;: { &quot;child&quot;: { &quot;id&quot;: 1026 }, &quot;parent&quot;: { &quot;id&quot;: 1024 } } }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Let’s break this down.</p><ul><li><code>{ child = { name = &quot;Fish&quot; }}</code> is a pattern that matches the key type of <code>Parent</code></li><li>So, looking at the schema, <code>{ name = &quot;Fish&quot; }</code> is a pattern that should match the <code>Class</code> in the field <code>child</code>.</li></ul><p>By default Angle queries are “shallow”, meaning they return just the facts that match and not the nested facts. We can see in the above result that the <code>child</code> and <code>parent</code> fields in the result just contain fact references like <code>{ &quot;id&quot; : 1026 }</code>. If we want to see the content of those references, we can ask Glean to recursively expand facts in the results. In the shell this is done by prefixing the query with <code>!</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lang=angle codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">facts&gt; ! example.Parent { child = { name = &quot;Fish&quot; }}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;id&quot;: 1029,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;key&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;child&quot;: { &quot;id&quot;: 1026, &quot;key&quot;: { &quot;name&quot;: &quot;Fish&quot;, &quot;line&quot;: 30 } },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;parent&quot;: { &quot;id&quot;: 1024, &quot;key&quot;: { &quot;name&quot;: &quot;Pet&quot;, &quot;line&quot;: 10 } }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>We can of course go the other way and find all the children of a class:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lang=angle codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">facts&gt; !example.Parent { parent = { name = &quot;Pet&quot; }}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;id&quot;: 1028,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;key&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;child&quot;: { &quot;id&quot;: 1025, &quot;key&quot;: { &quot;name&quot;: &quot;Lizard&quot;, &quot;line&quot;: 20 } },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;parent&quot;: { &quot;id&quot;: 1024, &quot;key&quot;: { &quot;name&quot;: &quot;Pet&quot;, &quot;line&quot;: 10 } }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;id&quot;: 1029,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;key&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;child&quot;: { &quot;id&quot;: 1026, &quot;key&quot;: { &quot;name&quot;: &quot;Fish&quot;, &quot;line&quot;: 30 } },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;parent&quot;: { &quot;id&quot;: 1024, &quot;key&quot;: { &quot;name&quot;: &quot;Pet&quot;, &quot;line&quot;: 10 } }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>But as before, note that this would be an inefficient query if we had a lot of data because the pattern is matching on the second field of <code>Parent</code> (namely <code>parent</code>). Later we’ll see how to make these queries more efficient using a derived predicate.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="union-types"></a>Union types<a class="hash-link" href="#union-types" title="Direct link to heading">#</a></h2><p>Our examples so far have dealt with record types. Glean also supports <em>union types</em>, also called <em>sum types</em>, which are used to express multiple alternatives. For example, let’s expand our schema to include class members which can be either a method or a variable:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lang=angle codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">predicate Has :</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    class_ : Class,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    has : Member,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    access : enum { Public | Private },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">predicate Member :</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    method : { name : string, doc : maybe string } |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    variable : { name : string }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The predicate <code>Has</code> maps a <code>Class</code> to a <code>Member</code> (with a <code>Public</code> or <code>Private</code> annotation), and a <code>Member</code> is either <code>method</code> or <code>variable</code>, with some associated data. Note that a <code>Class</code> might have more than one <code>Member</code>, which is fine: there can be multiple <code>Has</code> facts for a given <code>Class</code>.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>The schema uses <code>class_</code> rather than <code>class</code> as a field name, because <code>class</code> is a reserved word in Angle. There are many such reserved words, which are reserved not because Angle uses them, but because they cause problems for code that is automatically generated from the schema. To avoid having too many ad-hoc language-specific naming rules, Glean prevents certain problematic names from being used in the schema. The Angle compiler will tell you if you try to use a reserved word.</p></div></div><p>Let’s find classes that have a variable called <code>fins</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lang=angle codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">facts&gt; !example.Has { has = { variable = { name = &quot;fins&quot; }}}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;id&quot;: 1036,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;key&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;class_&quot;: { &quot;id&quot;: 1026, &quot;key&quot;: { &quot;name&quot;: &quot;Fish&quot;, &quot;line&quot;: 30 } },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;has&quot;: { &quot;id&quot;: 1035, &quot;key&quot;: { &quot;variable&quot;: { &quot;name&quot;: &quot;fins&quot; } } },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;access&quot;: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The key thing here is that we matched on <code>Member</code> which is a union type, using the pattern <code>{ variable = { name = &quot;fins&quot; }}</code>. A pattern to match a union type looks very much like a record pattern, but it can have only a single field, in this case either <code>variable</code> or <code>method</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="maybe"></a>Maybe<a class="hash-link" href="#maybe" title="Direct link to heading">#</a></h2><p>Glean has one built-in union type called <code>maybe</code>, which is useful when we want to have optional values in the data. It&#x27;s used in our example schema to attach optional documentation to a class member:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lang=angle codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">predicate Member :</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    method : { name : string, doc : maybe string } |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    variable : { name : string }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The type <code>maybe string</code> behaves exactly as if it were defined as the union type <code>{ nothing | just : string }</code>.  That means we can write a pattern that matches it, exactly as we would write a pattern for <code>{ nothing | just : string }</code>:</p><p>Methods without documentation:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">facts&gt; example.Member { method = { doc = nothing } }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Methods with documentation:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">facts&gt; example.Member { method = { doc = {  just = _ }}}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="or-patterns"></a>Or-patterns<a class="hash-link" href="#or-patterns" title="Direct link to heading">#</a></h2><p>In a pattern we can express multiple alternatives by separating patterns with a vertical bar <code>|</code>.</p><p>For example, we can find classes on lines 20 or 30:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lang=angle codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">facts&gt; example.Class { line = 20 | 30 }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;id&quot;: 1025, &quot;key&quot;: { &quot;name&quot;: &quot;Lizard&quot;, &quot;line&quot;: 20 } }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;id&quot;: 1026, &quot;key&quot;: { &quot;name&quot;: &quot;Fish&quot;, &quot;line&quot;: 30 } }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Or we can find all the classes that have either a <code>method</code> called <code>feed</code> or a <code>variable</code> with any name:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lang=angle codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">facts&gt; example.Has { has = { method = { name = &quot;feed&quot; }} | { variable = _ }}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(results omitted)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="more-complex-queries"></a>More complex queries<a class="hash-link" href="#more-complex-queries" title="Direct link to heading">#</a></h2><p>So far we’ve seen how to query for facts by matching patterns, including matching nested facts.  In this section we’ll see how to construct more complex queries that combine matching facts from multiple predicates.</p><p>Suppose we want to find all the parents of classes that have a variable called <code>fins</code>. We need to build a query that will</p><ul><li>find the classes with a variable called <code>fins</code> using <code>example.Has</code> as we did above</li><li>find their parents using <code>example.Parent</code></li></ul><p>We can combine these two as follows:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lang=angle codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">example.Has</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    class_ = C,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    has = { variable = { name = &quot;fins&quot; }}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">example.Parent { child = C }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>I’ve written this on several lines with indentation to illustrate it
better, to do this in the shell you will need to use the <code>:edit</code>
command to put the query in a temporary file.</p></div></div><p>The key thing here is that we used a <em>variable</em> <code>C</code> to stand for the <code>class_</code> field when matching facts of <code>example.Has</code>, and then we searched for <code>example.Parent</code> facts with the same value of <code>C</code> for the <code>child</code> field.</p><p>Note that variables must <em>always</em> begin with an upper-case letter, while schema names (<code>example)</code> and field names (<code>child</code>) begin with a lower-case letter.</p><p>The semicolon separates multiple <em>statements</em> in a query. When there are multiple statements the results of the query are the facts that match the last statement, in this case the <code>example.Parent</code>.  Let’s try it:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lang=angle codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">facts&gt; ! example.Has { class_ = C, has = { variable = { name = &quot;fins&quot; }}}; example.Parent { child = C }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;id&quot;: 1029,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;key&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;child&quot;: { &quot;id&quot;: 1026, &quot;key&quot;: { &quot;name&quot;: &quot;Fish&quot;, &quot;line&quot;: 30 } },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;parent&quot;: { &quot;id&quot;: 1024, &quot;key&quot;: { &quot;name&quot;: &quot;Pet&quot;, &quot;line&quot;: 10 } }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p> Suppose we don’t care too much about the child here, we only care about getting a list of the parents. We can avoid returning the redundant information by specifying explicitly what it is we want to return from the query:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lang=angle codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">P where</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    example.Has</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        class_ = C,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        has = { variable = { name = &quot;fins&quot; }}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    example.Parent { child = C, parent = P }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The general form of the query is <em><code>expression</code></em> <code>where</code> <em><code>statements</code></em>, where <em><code>expression</code></em> is an arbitrary expression and each statement is a pattern that matches some facts. The results of the query are the distinct values of <em><code>expression</code></em> for which all the statements match facts in the database.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lang=angle codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">facts&gt; ! P where example.Has { class_ = C, has = { variable = { name = &quot;fins&quot; }}}; example.Parent { child = C, parent = P }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;id&quot;: 1024, &quot;key&quot;: { &quot;name&quot;: &quot;Pet&quot;, &quot;line&quot;: 10 } }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="statements"></a>Statements<a class="hash-link" href="#statements" title="Direct link to heading">#</a></h2><p>In general, a statement can be of the form <em>A = B.</em> For example, if we write</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lang=angle codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">C = example.Class { name = &quot;Fish&quot; };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">example.Parent { child = C }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>that’s the same as</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lang=angle codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">example.Parent { child = { name = &quot;Fish&quot; }}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>A statement can have a pattern on either side, for example</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lang=angle codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">C where</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  C = example.Class { name = N };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  N = &quot;Fish&quot; | &quot;Goldfish&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>A statement can itself be a set of alternatives separated by a vertical bar <code>|</code>. For example, we can find classes that are either a parent of the <code>Goldfish</code> or have a <code>feed</code> method:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lang=angle codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">C where</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  example.Parent { child = { name = &quot;Goldfish&quot; }, parent = C } |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  example.Has { class_ = C, has = { method = { name = &quot;feed&quot; }}}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="arrays"></a>Arrays<a class="hash-link" href="#arrays" title="Direct link to heading">#</a></h2><p>When the schema uses an array, we need to be able to write queries that traverse the elements of the array. For example, a common use of an array is to represent the list of declarations in a source file. Our example schema defines the <code>FileClasses</code> predicate:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lang=angle codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">predicate FileClasses :</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    file : string,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    classes : [Class]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The goal here is to map efficiently from a filename to the list of classes defined in that file. Suppose we want to write a query that finds all the classes called <code>Goldfish</code> in the file <code>petshop.example</code>, we could do it like this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lang=angle codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">example.FileClasses { file = &quot;petshop.example&quot;, classes = Cs };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{ name = &quot;Goldfish&quot; } = Cs[..]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The second line is the interesting one: <code>{ name = &quot;Goldfish&quot; } = Cs[..]</code> means</p><ul><li>on the right-hand side, <code>Cs[..]</code> means “each element of the array <code>Cs</code>”</li><li>the left-hand side is a pattern, filtering only those <code>Class</code> facts that match <code>{ name = &quot;Goldfish&quot; }</code></li></ul><p>We can also match the whole array with a pattern of the form <code>[ p1, p2, ... ]</code></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lang=angle codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">facts&gt; X where [_,X,_] = [1,2,3]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;id&quot;: 1040, &quot;key&quot;: 2 }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="string-prefix"></a>String prefix<a class="hash-link" href="#string-prefix" title="Direct link to heading">#</a></h2><p>We’ve seen many examples of patterns that match strings. Glean also supports matching strings by <em>prefix</em>; for example:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lang=angle codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">facts&gt; example.Class { name = &quot;F&quot;.. }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;id&quot;: 1026, &quot;key&quot;: { &quot;name&quot;: &quot;Fish&quot;, &quot;line&quot;: 30 } }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The syntax <code>&quot;F&quot;..</code> means <em>strings beginning with the prefix</em> <code>”F&quot;</code>.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Why only prefix and not substring matching in general? Prefix matching can be supported efficiently by Glean’s prefix-tree representation of the fact database. Other kinds of string matching could be supported, but they wouldn’t be able to exploit the database representation so there’s little advantage to implementing them in Angle compared with filtering on the client-side.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="tuples"></a>Tuples<a class="hash-link" href="#tuples" title="Direct link to heading">#</a></h2><p>A <em>tuple</em> is just a a way of writing a record without the field names.  So for example, instead of</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">example.Parent { child = C }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>we could write</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">example.Parent { C, _ }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>When using a tuple you have to list <em>all</em> the fields, in the same order as they are declared in the schema.  That&#x27;s why <code>{ child = C }</code> becomes <code>{ C, _ }</code> when written as a tuple.</p><p>There are upsides and downsides to using the tuple notation:</p><ul><li>Pro: more concise</li><li>Con: brittle and sensitive to changes in the schema. If we add a field, then tuple patterns will break whereas record patterns won&#x27;t.</li></ul><p>As a rule of thumb we tend to use tuple syntax in cases where the predicate is &quot;obviously&quot; a relation, such as <code>example.Parent</code>, but we wouldn&#x27;t use tuple syntax for more complex records.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="enums-and-bool"></a>Enums and bool<a class="hash-link" href="#enums-and-bool" title="Direct link to heading">#</a></h2><p>An <code>enum</code> type is a set of named constants. In the <code>Has</code> predicate we used an <code>enum</code> type to indicate whether a class member is <code>Public</code> or <code>Private</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lang=angle codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">predicate Has :</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    class_ : Class,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    has : Member,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    access : enum { Public | Private },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>To match an <code>enum</code> we just use the appropriate identifier, in this case <code>Public</code> or <code>Private</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lang=angle codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">facts&gt; example.Has { access = Private }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;id&quot;: 1036, &quot;key&quot;: { &quot;class_&quot;: { &quot;id&quot;: 1026 }, &quot;has&quot;: { &quot;id&quot;: 1035 }, &quot;access&quot;: 1 } }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Note that in the JSON format results, an <code>enum</code> is represented by an integer. When you make queries in code, the <code>enum</code> will be represented by an appropriate type, such as a <code>data</code> type in Haskell.</p><p>The boolean type <code>bool</code> is a special case of an <code>enum</code>, defined like this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-lang=angle codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">type bool = enum { false | true }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/angle/intro"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Introduction</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/angle/efficiency"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Query Efficiency »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#just-the-facts" class="table-of-contents__link">Just the facts</a></li><li><a href="#matching-nested-facts" class="table-of-contents__link">Matching nested facts</a></li><li><a href="#union-types" class="table-of-contents__link">Union types</a></li><li><a href="#maybe" class="table-of-contents__link">Maybe</a></li><li><a href="#or-patterns" class="table-of-contents__link">Or-patterns</a></li><li><a href="#more-complex-queries" class="table-of-contents__link">More complex queries</a></li><li><a href="#statements" class="table-of-contents__link">Statements</a></li><li><a href="#arrays" class="table-of-contents__link">Arrays</a></li><li><a href="#string-prefix" class="table-of-contents__link">String prefix</a></li><li><a href="#tuples" class="table-of-contents__link">Tuples</a></li><li><a href="#enums-and-bool" class="table-of-contents__link">Enums and bool</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Learn</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction">Getting Started</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/fbOpenSource" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebookincubator/glean" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Legal</h4><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy</a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_31Aa"><img class="footer__logo" alt="Facebook Open Source Logo" src="/img/oss_logo.png"></a></div><div class="footer__copyright">Copyright © 2021 Facebook, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.e09754bf.js"></script>
<script src="/runtime~main.a3268b2c.js"></script>
<script src="/main.d925dd03.js"></script>
<script src="/1.59982928.js"></script>
<script src="/2.5fa3e0ee.js"></script>
<script src="/3.88208a2f.js"></script>
<script src="/1be78505.126bd22c.js"></script>
<script src="/52.0116e487.js"></script>
<script src="/935f2afb.ed8fbd3b.js"></script>
<script src="/17896441.6e417407.js"></script>
<script src="/3a62bff6.4be436fc.js"></script>
</body>
</html>