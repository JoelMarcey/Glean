<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Glean Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Glean Blog Atom Feed"><title data-react-helmet="true">Writing data to Glean | Glean</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Writing data to Glean | Glean"><meta data-react-helmet="true" name="description" content="This page describes the various ways in which data gets into Glean."><meta data-react-helmet="true" property="og:description" content="This page describes the various ways in which data gets into Glean."><meta data-react-helmet="true" property="og:url" content="https://glean.software/docs/write"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://glean.software/docs/write"><link rel="stylesheet" href="/styles.b813eb11.css">
<link rel="preload" href="/styles.e09754bf.js" as="script">
<link rel="preload" href="/runtime~main.1396cc64.js" as="script">
<link rel="preload" href="/main.7f1beb1c.js" as="script">
<link rel="preload" href="/1.59982928.js" as="script">
<link rel="preload" href="/2.5fa3e0ee.js" as="script">
<link rel="preload" href="/3.88208a2f.js" as="script">
<link rel="preload" href="/1be78505.126bd22c.js" as="script">
<link rel="preload" href="/52.0116e487.js" as="script">
<link rel="preload" href="/935f2afb.5c27bb40.js" as="script">
<link rel="preload" href="/17896441.6e417407.js" as="script">
<link rel="preload" href="/92b0e865.914ee04a.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><strong class="navbar__title">Glean</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/introduction">Documentation</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebookincubator/glean" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><strong class="navbar__title">Glean</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/introduction">Documentation</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/facebookincubator/glean" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Quick Start</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/introduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/trying">Trying Glean</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/building">Building Glean</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/walkthrough">Walkthrough</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">User Guide</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Schemas</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/schema/basic">Basic Concepts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/schema/types">Built-in Types</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/schema/syntax">Syntax</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/schema/recursion">Recursion</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/schema/changing">Changing a schema</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/schema/workflow">Workflow</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/schema/thrift">Thrift and JSON</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Querying</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/query/intro">Overview</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Angle</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/angle/intro">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/angle/guide">Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/angle/efficiency">Query Efficiency</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/angle/advanced">Advanced Query Features</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/angle/debugging">Debugging</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/angle/reference">Reference</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/angle/style">Style Guide</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">APIs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/query/api/haskell">Haskell</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/derived">Derived Predicates</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/databases">Glean Databases</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/write">Writing data to Glean</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/running">Running the Tools</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/shell">Using the Shell</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/server">Running the Glean Server</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cli">The Glean CLI tool</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Indexers</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/indexer/intro">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/indexer/flow">Javascript (Flow)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/indexer/hack">Hack</a></li></ul></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Writing data to Glean</h1></header><div class="markdown"><p>This page describes the various ways in which data gets into Glean.</p><p>There are two main methods for creating a DB. Repo-wide indexing jobs
which require multiple workers and have dependent tasks are managed by
the server, while simple one-off DB creation can be performed
independently by a single client.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="client-driven-writing"></a>Client-driven writing<a class="hash-link" href="#client-driven-writing" title="Direct link to heading">#</a></h2><p>A database can be created by a client using any of these methods:</p><ol><li>Programmatically, using one of the APIs listed in <a href="#apis-for-writing">APIs for Writing</a>.</li><li>On the command line: invoke the <code>glean</code> command-line tool to send data in JSON format, see <a href="#creating-a-database-usin"> Creating a database using the command line</a>.</li><li>In the shell, use <code>glean-shell --db-root=&lt;dir&gt;</code> and then use the command <code>:load</code> to create a DB from a JSON file. See <a href="#loading-a-db-from-json-i"> Loading a DB from JSON in the shell</a>.</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="server-driven-writing"></a>Server-driven writing<a class="hash-link" href="#server-driven-writing" title="Direct link to heading">#</a></h2><p>Large indexing jobs are coordinated by the server, using a <em>recipe</em> to
define the various tasks and the dependencies between them.  Recipes
are defined in the recipes configuration; see the <code>--recipe-config</code>
option in <a href="/docs/running#common-options">Common options</a>.</p><p>The job proceeds as follows:</p><ul><li><p>An indexing job is started by calling the server&#x27;s <code>kickOff</code> Thrift
method. This creates a work queue of tasks on the server.</p></li><li><p>Clients obtain tasks from the server by calling <code>getWork</code>. Tasks may
have dependencies between them, so the server won&#x27;t hand out a task
until its dependencies are complete.</p></li><li><p>When all tasks are done, the server marks the database as complete.</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="apis-for-writing"></a>APIs for writing<a class="hash-link" href="#apis-for-writing" title="Direct link to heading">#</a></h2><ul><li>The Haskell API for writing<ul><li>Example: <a href="https://github.com/facebookincubator/Glean/tree/master/glean/client/hs/example/ExampleWriter.hs">glean/client/hs/example/ExampleWriter.hs</a></li></ul></li></ul><p>If none of the above work for you, the Thrift API enable basic write
access to the database.</p><ul><li><code>kickOff</code> can be used to create a new DB</li><li><code>sendJsonBatch</code> is for sending facts in JSON-serialized form</li><li><code>finishBatch</code> exposes the result of a previously sent JSON batch</li><li><code>workFinished</code> closes a DB</li></ul><p>A rough outline of a client looks like:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">glean = make_glean_thrift_client()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">db_handle = make_uuid()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">glean.kickOff(my_repo, KickOffFill(writeHandle=db_handle))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">for json_batch in json_batches:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    handle = glean.sendJsonBatch(json_batch)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    result = glean.finishBatch(handle)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    # handle result</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">glean.workFinished(my_repo, db_handle, success_or_failure)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="writing-from-the-command-line"></a>Writing from the command line<a class="hash-link" href="#writing-from-the-command-line" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="json-format"></a>JSON format<a class="hash-link" href="#json-format" title="Direct link to heading">#</a></h3><p>The JSON format for Glean data is described in <a href="/docs/schema/thrift">Thrift and JSON</a>.</p><p>Here&#x27;s an example of JSON data for writing to Glean:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  { &quot;predicate&quot;: &quot;cxx1.Name.1&quot;,          # define facts for cxx1.Name.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;facts&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      { &quot;id&quot;: 1, &quot;key&quot;: &quot;abc&quot; },         # define a fact with id 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      { &quot;id&quot;: 2, &quot;key&quot;: &quot;def&quot; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  { &quot;predicate&quot;: &quot;cxx1.FunctionName.1&quot;,  # define facts for cxx1.FunctionName.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;facts&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      { &quot;id&quot;: 3,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;key&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;name&quot;: { &quot;id&quot;: 1 }}}          # reference to fact with id 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  { &quot;predicate&quot;: &quot;cxx1.FunctionQName.1&quot;, # define facts for cxx1.FunctionQName.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;facts&quot;: [</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      { &quot;key&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;name&quot;: 3,                       # 3 is shorthand for { &quot;id&quot;: 3 }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;scope&quot;: { &quot;global_&quot;: {} } } },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      { &quot;key&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;name&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;key&quot;: {                       # define a nested fact directly</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;name&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              &quot;key&quot;: &quot;ghi&quot; }}},         # another nested fact</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;scope&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          &quot;namespace_&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;key&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              &quot;name&quot;: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                &quot;key&quot;: &quot;std&quot; }}}}}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The rules of the game are:</p><ul><li>Predicate names must include versions, i.e. <code>cxx1.Name.1</code> rather than <code>cxx1.Name</code>.</li><li>The <code>id</code> field when defining a fact is optional. The <code>id</code> numbers in the input file will <em>not</em> be the final <code>id</code> numbers assigned to the facts in the database.</li><li>There are no restrictions on <code>id</code> values (any 64-bit integer will do) but an <code>id</code> value may not be reused within a file.</li><li>Later facts may refer to earlier ones using either <code>{ &quot;id&quot;: N }</code> or just <code>N</code>.</li><li>It is only possible to refer to <code>id</code>s from facts in the same file, if you are writing multiple files using <code>glean write</code> or via the <code>sendJsonBatch</code> API.</li><li>a nested facts can be defined inline, instead of defining it with an <code>id</code> first and then referencing it.</li><li>an inline nested fact can be given an <code>id</code> and referred to later.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="loading-a-db-from-json-in-the-shell"></a>Loading a DB from JSON in the shell<a class="hash-link" href="#loading-a-db-from-json-in-the-shell" title="Direct link to heading">#</a></h3><p>The shell is useful for experimenting with creating a DB from JSON data directly. Let&#x27;s try loading the data above into a DB in the shell:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ mkdir /tmp/glean</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ glean-shell --db-root /tmp/glean</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Glean Shell, dev mode</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">type :help for help.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">no fbsource database availabe</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&gt; :load test/0 /home/smarlow/test</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">I0514 01:19:37.137109 3566745 Work.hs:184] test/16: database complete</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Let&#x27;s see what facts we loaded:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">test&gt; :stat</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  count: 72</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  size:  5988</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cxx1.FunctionName.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  count: 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  size:  66</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cxx1.FunctionQName.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  count: 2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  size:  70</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cxx1.Name.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  count: 4</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  size:  148</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">cxx1.NamespaceQName.1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  count: 1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  size:  35</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">test&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Note that there were 4 <code>cxx1.Name.1</code> facts - some of those were defined as inline nested facts in the JSON. We can query them all:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">test&gt; cxx1.Name _</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">4 results, 1 queries, 4 facts, 0.22ms, 44296 bytes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;id&quot;: 1096, &quot;key&quot;: &quot;abc&quot; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;id&quot;: 1097, &quot;key&quot;: &quot;def&quot; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;id&quot;: 1100, &quot;key&quot;: &quot;ghi&quot; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{ &quot;id&quot;: 1102, &quot;key&quot;: &quot;std&quot; }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Note that the <code>id</code> values here do not correspond to the <code>id</code> values in the input file.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="creating-a-database-using-the-command-line"></a>Creating a database using the command line<a class="hash-link" href="#creating-a-database-using-the-command-line" title="Direct link to heading">#</a></h3><p>The <code>glean</code> command-line tool can be used to create a database directly on the server.</p><p>To create a database from a single file of JSON facts:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">glean --service &lt;write-server&gt; create --finish --repo &lt;name&gt;/&lt;hash&gt; &lt;filename&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>where</p><ul><li><code>&lt;write-server&gt;</code> is the <code>host:port</code> of the Glean server</li></ul><ul><li><code>&lt;name&gt;</code> is the name for your DB. For indexing repositories we normally use the name of the repository, but it&#x27;s just a string, so you can use whatever you want.</li><li><code>&lt;hash&gt;</code> identifies this particular instance of your database. For repositories we normally use the revision hash, but, again, it&#x27;s just a string.</li><li><code>&lt;filename&gt;</code> the file containing the JSON facts.</li></ul><p>If the file is more than, say, 100MB, this operation will probably time out sending the data to the server. To send large amounts of data you need to batch it up into multiple files, and then send it like this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">glean --service &lt;write-server&gt; create --repo &lt;name&gt;/&lt;hash&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">glean --service &lt;write-server&gt; write --repo &lt;name&gt;/&lt;hash&gt; &lt;filename1&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">glean --service &lt;write-server&gt; write --repo &lt;name&gt;/&lt;hash&gt; &lt;filename2&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">glean --service &lt;write-server&gt; finish --repo &lt;name&gt;/&lt;hash&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>To find out if your DB made it:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">glean-shell --service &lt;write-server&gt; :list</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This will list the DBs available on the write server.</p><div></div><div></div></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/databases"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Glean Databases</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/running"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Running the Tools Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#client-driven-writing" class="table-of-contents__link">Client-driven writing</a></li><li><a href="#server-driven-writing" class="table-of-contents__link">Server-driven writing</a></li><li><a href="#apis-for-writing" class="table-of-contents__link">APIs for writing</a></li><li><a href="#writing-from-the-command-line" class="table-of-contents__link">Writing from the command line</a><ul><li><a href="#json-format" class="table-of-contents__link">JSON format</a></li><li><a href="#loading-a-db-from-json-in-the-shell" class="table-of-contents__link">Loading a DB from JSON in the shell</a></li><li><a href="#creating-a-database-using-the-command-line" class="table-of-contents__link">Creating a database using the command line</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Learn</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction">Getting Started</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/fbOpenSource" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebookincubator/glean" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Legal</h4><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy</a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_31Aa"><img class="footer__logo" alt="Facebook Open Source Logo" src="/img/oss_logo.png"></a></div><div class="footer__copyright">Copyright Â© 2021 Facebook, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.e09754bf.js"></script>
<script src="/runtime~main.1396cc64.js"></script>
<script src="/main.7f1beb1c.js"></script>
<script src="/1.59982928.js"></script>
<script src="/2.5fa3e0ee.js"></script>
<script src="/3.88208a2f.js"></script>
<script src="/1be78505.126bd22c.js"></script>
<script src="/52.0116e487.js"></script>
<script src="/935f2afb.5c27bb40.js"></script>
<script src="/17896441.6e417407.js"></script>
<script src="/92b0e865.914ee04a.js"></script>
</body>
</html>